# ========================================
# KARINA'S DASHBOARD - CONFIGURACIÓN APACHE
# ========================================
# Configuración optimizada para Laravel + Filament en Honduras

<VirtualHost *:80>
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    
    # Redirigir todo el tráfico HTTP a HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName tu-dominio.com
    ServerAlias www.tu-dominio.com
    
    # Directorio raíz del proyecto
    DocumentRoot /var/www/karinas-dashboard/public
    
    # ========================================
    # CONFIGURACIÓN SSL
    # ========================================
    
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    SSLCertificateChainFile /path/to/your/ca-bundle.crt
    
    # Configuración SSL moderna
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder off
    SSLSessionTickets off
    
    # HSTS (opcional pero recomendado)
    Header always set Strict-Transport-Security "max-age=63072000"
    
    # ========================================
    # CONFIGURACIÓN DE DIRECTORIO
    # ========================================
    
    <Directory /var/www/karinas-dashboard/public>
        AllowOverride All
        Require all granted
        
        # Configuración específica para Laravel
        Options -Indexes +FollowSymLinks
        
        # Rewrite rules para Laravel
        RewriteEngine On
        
        # Handle Angular and Laravel routes
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L]
    </Directory>
    
    # ========================================
    # CONFIGURACIÓN PHP
    # ========================================
    
    # Configuraciones específicas para Filament
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value max_input_time 300
    php_value memory_limit 256M
    
    # ========================================
    # HEADERS DE SEGURIDAD
    # ========================================
    
    # Headers de seguridad generales
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    
    # ========================================
    # CONFIGURACIÓN PARA HONDURAS
    # ========================================
    
    # Headers personalizados para identificar el país
    Header always set X-Country "Honduras"
    Header always set X-Currency "HNL"
    Header always set X-Timezone "America/Tegucigalpa"
    
    # ========================================
    # OPTIMIZACIÓN DE ARCHIVOS ESTÁTICOS
    # ========================================
    
    # Compresión GZIP
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
    
    # Configuración de cache para archivos estáticos
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType text/javascript "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType application/x-shockwave-flash "access plus 1 month"
        ExpiresByType image/x-icon "access plus 1 year"
        ExpiresDefault "access plus 1 week"
    </IfModule>
    
    # ========================================
    # CONFIGURACIÓN ESPECÍFICA PARA FILAMENT
    # ========================================
    
    # Protección adicional para el panel de admin
    <Location "/admin">
        # Rate limiting básico (requiere mod_evasive)
        # DOSHashTableSize    128
        # DOSPageCount        5
        # DOSSiteCount        50
        # DOSPageInterval     1
        # DOSSiteInterval     1
        # DOSBlockingPeriod   600
    </Location>
    
    # Denegar acceso a archivos sensibles
    <Files ".env">
        Require all denied
    </Files>
    
    <Files "composer.json">
        Require all denied
    </Files>
    
    <Files "composer.lock">
        Require all denied
    </Files>
    
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    # ========================================
    # LOGS
    # ========================================
    
    CustomLog /var/log/apache2/karinas-dashboard.access.log combined
    ErrorLog /var/log/apache2/karinas-dashboard.error.log
    LogLevel warn
    
</VirtualHost>

# ========================================
# CONFIGURACIÓN GLOBAL
# ========================================

# Ocultar información del servidor
ServerTokens Prod
ServerSignature Off
